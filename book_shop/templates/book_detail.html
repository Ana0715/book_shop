{% extends "base.html" %}


{% block title %}{{ book.title }}{% endblock %}


{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-4">
      <img
        src="{{ book.cover or 'https://via.placeholder.com/300x450?text=No+Cover' }}"
        alt="{{ book.title }}"
        class="img-thumbnail"
      >
    </div>

    <div class="col-md-8">
      <h1>{{ book.title }}</h1>
      <p class="lead text-muted">Автор: <strong>{{ book.author }}</strong></p>
      <div class="mb-3">
        <span class="badge bg-primary">{{ book.genre }}</span>
        {% if book.year %}<span class="badge bg-secondary">{{ book.year }}</span>{% endif %}
        {% if book.rating %}<span class="badge bg-warning text-dark">Рейтинг: {{ book.rating }}</span>{% endif %}
      </div>
      <div class="mb-4">
        <h4>Описание</h4>
        <p>{{ book.description or "Описание отсутствует." }}</p>
      </div>
      <div class="d-flex gap-2">
        <h3 class="text-primary">₽{{ book.price }}</h3>
        {% if current_user.is_authenticated %}
          <form method="POST" action="{{ url_for('main.add_to_cart', book_id=book.id) }}" style="display:inline;">
            <button type="submit" class="btn btn-success">Купить</button>
          </form>
          <a href="{{ url_for('main.cart') }}" class="btn btn-primary btn-sm" id="cart-btn">Корзина</a>

        {% else %}
          <a href="{{ url_for('main.login') }}" class="btn btn-success">Войти для покупки</a>
        {% endif %}

        <a href="{{ url_for('main.main_route') }}" class="btn btn-outline-secondary">Назад в каталог</a>
      </div>
      <div class="row mt-5">
        <div class="col-12">
          <h4>Детали</h4>
          <ul class="list-group">
            <li class="list-group-item"><strong>ID:</strong> {{ book.id }}</li>
            <li class="list-group-item"><strong>Жанр:</strong> {{ book.genre }}</li>
            {% if book.year %}<li class="list-group-item"><strong>Год издания:</strong> {{ book.year }}</li>{% endif %}
            {% if book.rating %}<li class="list-group-item"><strong>Рейтинг:</strong> {{ book.rating }} из 5</li>{% endif %}
          </ul>
        </div>
      </div>


      {% if current_user.is_authenticated %}
        <a
          href="{{ url_for('main.add_review', book_id=book.id) }}"
          class="btn btn-outline-primary mt-3"
        >
          Добавить отзыв
        </a>
      {% else %}
        <p class="text-muted mt-3">
          Чтобы оставить отзыв, <a href="{{ url_for('main.login') }}">войдите</a> или <a href="{{ url_for('main.register') }}">зарегистрируйтесь</a>.
        </p>
      {% endif %}
    </div>
  </div>

  <div class="mt-5">
    <h3>Отзывы</h3>
    {% if reviews %}
      {% for review in reviews %}
        <div class="card mb-3">
          <div class="card-body">
            <p class="card-text">{{ review.text }}</p>
            <small class="text-muted">
              Оценка: {{ review.rating }}/5 ·
              {{ review.created_at.strftime('%d.%m.%Y') }}
            </small>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted">Пока нет отзывов.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
